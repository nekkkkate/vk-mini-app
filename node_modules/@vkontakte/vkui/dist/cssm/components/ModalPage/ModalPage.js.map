{"version":3,"sources":["../../../../src/components/ModalPage/ModalPage.tsx"],"sourcesContent":["'use client';\n\nimport { useMemo } from 'react';\nimport { ModalContext } from '../../context/ModalContext';\nimport { inRange } from '../../helpers/range';\nimport { SNAP_POINT_DETENTS, SNAP_POINT_SAFE_RANGE, type SnapPoint } from '../../lib/sheet';\nimport { useModalManager } from '../ModalRoot/useModalManager';\nimport { ModalPageInternal } from './ModalPageInternal';\nimport type { ModalPageProps } from './types';\n\nconst snapPointCache = new Map<string, Exclude<SnapPoint, 'auto'>>();\n\n/**\n * @see https://vkui.io/components/modal-page\n */\nexport const ModalPage = ({\n  id: idProp,\n  nav,\n  open = false,\n  modalOverlayTestId,\n  noFocusToDialog,\n  onOpen,\n  onOpened,\n  onClose,\n  onClosed,\n  size = 's',\n  settlingHeight = 50,\n  dynamicContentHeight,\n  disableModalOverlay,\n  keepMounted = false,\n  ...restProps\n}: ModalPageProps) => {\n  const { mounted, shouldPreserveSnapPoint, id, ...resolvedProps } = useModalManager({\n    id: nav || idProp,\n    open,\n    keepMounted,\n    modalOverlayTestId,\n    disableModalOverlay,\n    noFocusToDialog,\n    onOpen,\n    onOpened,\n    onClose,\n    onClosed,\n  });\n\n  const snapPoint = useMemo((): SnapPoint => {\n    if (dynamicContentHeight) {\n      return 'auto';\n    }\n\n    if (shouldPreserveSnapPoint) {\n      const snapPointCached = snapPointCache.get(id);\n\n      if (snapPointCached) {\n        return snapPointCached;\n      }\n\n      const nextSnapPoint = transformSettlingHeightToSnapPoint(settlingHeight);\n      snapPointCache.set(id, nextSnapPoint);\n\n      return nextSnapPoint;\n    } else {\n      snapPointCache.delete(id);\n    }\n\n    return transformSettlingHeightToSnapPoint(settlingHeight);\n  }, [id, shouldPreserveSnapPoint, dynamicContentHeight, settlingHeight]);\n\n  if (!mounted) {\n    return null;\n  }\n\n  return (\n    <ModalContext.Provider value={id}>\n      <ModalPageInternal\n        id={id}\n        size={size}\n        aria-labelledby={`${id}-label`}\n        snapPoint={snapPoint}\n        onSnapPointChange={\n          snapPoint !== 'auto' && shouldPreserveSnapPoint\n            ? (snapPoint) => {\n                const snapPointCached = snapPointCache.get(id);\n\n                if (snapPointCached) {\n                  snapPointCached.initial = snapPoint;\n                  snapPointCache.set(id, snapPointCached);\n                }\n              }\n            : undefined\n        }\n        {...resolvedProps}\n        {...restProps}\n      />\n    </ModalContext.Provider>\n  );\n};\n\nfunction transformSettlingHeightToSnapPoint(settlingHeight: number): Exclude<SnapPoint, 'auto'> {\n  const currentSnapPoint = Math.min(\n    Math.max(settlingHeight, SNAP_POINT_SAFE_RANGE.LOWER),\n    SNAP_POINT_DETENTS.LARGE,\n  );\n\n  return {\n    initial: currentSnapPoint,\n    detents: inRange(currentSnapPoint, SNAP_POINT_SAFE_RANGE.LOWER, SNAP_POINT_SAFE_RANGE.HIGHEST)\n      ? [SNAP_POINT_DETENTS.MIN, currentSnapPoint, SNAP_POINT_DETENTS.LARGE]\n      : [SNAP_POINT_DETENTS.MIN, currentSnapPoint],\n  };\n}\n"],"names":["useMemo","ModalContext","inRange","SNAP_POINT_DETENTS","SNAP_POINT_SAFE_RANGE","useModalManager","ModalPageInternal","snapPointCache","Map","ModalPage","id","idProp","nav","open","modalOverlayTestId","noFocusToDialog","onOpen","onOpened","onClose","onClosed","size","settlingHeight","dynamicContentHeight","disableModalOverlay","keepMounted","restProps","mounted","shouldPreserveSnapPoint","resolvedProps","snapPoint","snapPointCached","get","nextSnapPoint","transformSettlingHeightToSnapPoint","set","delete","Provider","value","aria-labelledby","onSnapPointChange","initial","undefined","currentSnapPoint","Math","min","max","LOWER","LARGE","detents","HIGHEST","MIN"],"mappings":"AAAA;;AAEA,SAASA,OAAO,QAAQ,QAAQ;AAChC,SAASC,YAAY,QAAQ,gCAA6B;AAC1D,SAASC,OAAO,QAAQ,yBAAsB;AAC9C,SAASC,kBAAkB,EAAEC,qBAAqB,QAAwB,2BAAkB;AAC5F,SAASC,eAAe,QAAQ,kCAA+B;AAC/D,SAASC,iBAAiB,QAAQ,yBAAsB;AAGxD,MAAMC,iBAAiB,IAAIC;AAE3B;;CAEC,GACD,OAAO,MAAMC,YAAY,CAAC,EACxBC,IAAIC,MAAM,EACVC,GAAG,EACHC,OAAO,KAAK,EACZC,kBAAkB,EAClBC,eAAe,EACfC,MAAM,EACNC,QAAQ,EACRC,OAAO,EACPC,QAAQ,EACRC,OAAO,GAAG,EACVC,iBAAiB,EAAE,EACnBC,oBAAoB,EACpBC,mBAAmB,EACnBC,cAAc,KAAK,EACnB,GAAGC,WACY;IACf,MAAM,EAAEC,OAAO,EAAEC,uBAAuB,EAAEjB,EAAE,EAAE,GAAGkB,eAAe,GAAGvB,gBAAgB;QACjFK,IAAIE,OAAOD;QACXE;QACAW;QACAV;QACAS;QACAR;QACAC;QACAC;QACAC;QACAC;IACF;IAEA,MAAMU,YAAY7B,QAAQ;QACxB,IAAIsB,sBAAsB;YACxB,OAAO;QACT;QAEA,IAAIK,yBAAyB;YAC3B,MAAMG,kBAAkBvB,eAAewB,GAAG,CAACrB;YAE3C,IAAIoB,iBAAiB;gBACnB,OAAOA;YACT;YAEA,MAAME,gBAAgBC,mCAAmCZ;YACzDd,eAAe2B,GAAG,CAACxB,IAAIsB;YAEvB,OAAOA;QACT,OAAO;YACLzB,eAAe4B,MAAM,CAACzB;QACxB;QAEA,OAAOuB,mCAAmCZ;IAC5C,GAAG;QAACX;QAAIiB;QAAyBL;QAAsBD;KAAe;IAEtE,IAAI,CAACK,SAAS;QACZ,OAAO;IACT;IAEA,qBACE,KAACzB,aAAamC,QAAQ;QAACC,OAAO3B;kBAC5B,cAAA,KAACJ;YACCI,IAAIA;YACJU,MAAMA;YACNkB,mBAAiB,GAAG5B,GAAG,MAAM,CAAC;YAC9BmB,WAAWA;YACXU,mBACEV,cAAc,UAAUF,0BACpB,CAACE;gBACC,MAAMC,kBAAkBvB,eAAewB,GAAG,CAACrB;gBAE3C,IAAIoB,iBAAiB;oBACnBA,gBAAgBU,OAAO,GAAGX;oBAC1BtB,eAAe2B,GAAG,CAACxB,IAAIoB;gBACzB;YACF,IACAW;YAEL,GAAGb,aAAa;YAChB,GAAGH,SAAS;;;AAIrB,EAAE;AAEF,SAASQ,mCAAmCZ,cAAsB;IAChE,MAAMqB,mBAAmBC,KAAKC,GAAG,CAC/BD,KAAKE,GAAG,CAACxB,gBAAgBjB,sBAAsB0C,KAAK,GACpD3C,mBAAmB4C,KAAK;IAG1B,OAAO;QACLP,SAASE;QACTM,SAAS9C,QAAQwC,kBAAkBtC,sBAAsB0C,KAAK,EAAE1C,sBAAsB6C,OAAO,IACzF;YAAC9C,mBAAmB+C,GAAG;YAAER;YAAkBvC,mBAAmB4C,KAAK;SAAC,GACpE;YAAC5C,mBAAmB+C,GAAG;YAAER;SAAiB;IAChD;AACF"}